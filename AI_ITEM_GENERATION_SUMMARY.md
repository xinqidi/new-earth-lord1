# AI ç”Ÿæˆç‰©å“åŠŸèƒ½å®ç°æ€»ç»“

## åŠŸèƒ½æ¦‚è¿°

AI ç”Ÿæˆç‰©å“åŠŸèƒ½å·²å®Œå…¨å®ç°ã€‚æ¯æ¬¡ç©å®¶æœåˆ® POI æ—¶ï¼Œæ‰€æœ‰ç‰©å“å°†ç”±é˜¿é‡Œäº‘ç™¾ç‚¼ AIï¼ˆqwen-turboï¼‰å®æ—¶ç”Ÿæˆï¼Œç‰©å“ç¨€æœ‰åº¦ç”± POI å±é™©ç­‰çº§å†³å®šã€‚

## æŠ€æœ¯æ¶æ„

```
iOS App (Swift)
    â†“ (è°ƒç”¨)
AIItemGenerator.swift
    â†“ (HTTP POST)
Supabase Edge Function (generate-ai-items)
    â†“ (API è°ƒç”¨)
é˜¿é‡Œäº‘ç™¾ç‚¼ (qwen-turbo)
    â†“ (è¿”å›)
AI ç”Ÿæˆçš„ç‰©å“ (å¸¦èƒŒæ™¯æ•…äº‹)
```

## å·²å®Œæˆçš„åŠŸèƒ½

### âœ… 1. æ•°æ®æ¨¡å‹æ‰©å±•

**æ–‡ä»¶ï¼š** `Models/MockExplorationData.swift`

- **DangerLevel æšä¸¾** (ç¬¬ 38-77 è¡Œ)
  - `low` (1): ä½å± - æ™®é€š70%, ä¼˜ç§€25%, ç¨€æœ‰5%
  - `medium` (3): ä¸­å± - æ™®é€š50%, ä¼˜ç§€30%, ç¨€æœ‰15%, å²è¯—5%
  - `high` (4): é«˜å± - ä¼˜ç§€40%, ç¨€æœ‰35%, å²è¯—20%, ä¼ å¥‡5%
  - `extreme` (5): æå± - ç¨€æœ‰30%, å²è¯—40%, ä¼ å¥‡30%

- **POI.dangerLevel å±æ€§** (ç¬¬ 88 è¡Œ)
  - æ¯ä¸ª POI éƒ½æœ‰å±é™©ç­‰çº§
  - é»˜è®¤æ ¹æ® POI ç±»å‹è‡ªåŠ¨åˆ†é…ï¼ˆç¬¬ 65-76 è¡Œï¼‰

**æ–‡ä»¶ï¼š** `Managers/ExplorationManager.swift`

- **RewardItem.story å­—æ®µ** (ç¬¬ 124 è¡Œ)
  - ç”¨äºå­˜å‚¨ AI ç”Ÿæˆçš„ç‰©å“èƒŒæ™¯æ•…äº‹
  - å¯é€‰å­—æ®µï¼Œå¤‡ç”¨ç”Ÿæˆä¹Ÿä¼šæä¾›ç®€å•æ•…äº‹

### âœ… 2. AI ç‰©å“ç”Ÿæˆå™¨

**æ–‡ä»¶ï¼š** `Managers/AIItemGenerator.swift`

- **generateItems()** (ç¬¬ 84-158 è¡Œ)
  - è°ƒç”¨ Supabase Edge Function
  - ä¼ é€’ POI ä¿¡æ¯ï¼ˆåç§°ã€ç±»å‹ã€å±é™©ç­‰çº§ã€æ•°é‡ï¼‰
  - è§£æ AI è¿”å›çš„ç‰©å“æ•°æ®
  - è½¬æ¢ä¸º RewardItem æ ¼å¼

- **generateFallbackItems()** (ç¬¬ 167-192 è¡Œ)
  - AI ç”Ÿæˆå¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ
  - æ ¹æ®å±é™©ç­‰çº§ç”Ÿæˆåˆç†çš„ç¨€æœ‰åº¦åˆ†å¸ƒ
  - ä¸ºæ¯ä¸ªç‰©å“ç”Ÿæˆç®€å•çš„èƒŒæ™¯æ•…äº‹

- **ç¨€æœ‰åº¦æ¦‚ç‡åˆ†å¸ƒ** (ç¬¬ 195-234 è¡Œ)
  - ç²¾ç¡®åŒ¹é…è®¾è®¡æ–‡æ¡£ä¸­çš„æ¦‚ç‡
  - æ ¹æ®å±é™©ç­‰çº§åŠ¨æ€è°ƒæ•´

- **å¤‡ç”¨ç‰©å“åº“** (ç¬¬ 237-303 è¡Œ)
  - 7 ç§ POI ç±»å‹çš„å¤‡ç”¨ç‰©å“
  - æ¯ç§ç¨€æœ‰åº¦éƒ½æœ‰å¯¹åº”ç‰©å“
  - ç¬¦åˆæœ«æ—¥åºŸåœŸä¸–ç•Œè§‚

### âœ… 3. Edge Function

**æ–‡ä»¶ï¼š**
- `supabase/functions/generate-ai-items/index.ts`
- `supabase/functions/generate-ai-items/deno.json`

**åŠŸèƒ½ï¼š**
- æ¥æ”¶ POI ä¿¡æ¯è¯·æ±‚
- æ„å»ºç¬¦åˆæœ«æ—¥åºŸåœŸä¸–ç•Œè§‚çš„æç¤ºè¯
- è°ƒç”¨é˜¿é‡Œäº‘ç™¾ç‚¼ qwen-turbo æ¨¡å‹
- è§£æ AI è¿”å›çš„ JSONï¼ˆæ”¯æŒ markdown åŒ…è£¹ï¼‰
- è¿”å›æ ‡å‡†æ ¼å¼çš„ç‰©å“æ•°æ®

**ç¨€æœ‰åº¦æ˜ å°„ï¼š**
```typescript
æ™®é€š â†’ common
ä¼˜ç§€ â†’ uncommon
ç¨€æœ‰ â†’ rare
å²è¯— â†’ epic
ä¼ å¥‡ â†’ legendary
```

**ç‰©å“åˆ†ç±»ï¼š**
- foodï¼ˆé£Ÿç‰©ï¼‰
- medicineï¼ˆåŒ»ç–—ï¼‰
- materialï¼ˆææ–™ï¼‰
- toolï¼ˆå·¥å…·ï¼‰
- clothingï¼ˆè¡£ç‰©ï¼‰
- weaponï¼ˆæ­¦å™¨ï¼‰

### âœ… 4. POI æœç´¢é›†æˆ

**æ–‡ä»¶ï¼š** `Managers/POISearchManager.swift`

- POI åˆ›å»ºæ—¶è‡ªåŠ¨åˆ†é…å±é™©ç­‰çº§ (ç¬¬ 192-199 è¡Œ)
- ä½¿ç”¨ `DangerLevel.defaultLevel(for: type)` è‡ªåŠ¨åˆ†é…
- è¶…å¸‚ã€è¯åº— â†’ ä½å±
- åŠ æ²¹ç«™ã€å­¦æ ¡ â†’ ä¸­å±
- åŒ»é™¢ã€ä»“åº“ â†’ é«˜å±
- å·¥å‚ â†’ æå±

### âœ… 5. æœåˆ®é€»è¾‘é›†æˆ

**æ–‡ä»¶ï¼š** `Managers/ExplorationManager.swift`

- **scavengePOI()** (ç¬¬ 1059-1096 è¡Œ)
  - æ ¹æ®å±é™©ç­‰çº§è®¡ç®—ç‰©å“æ•°é‡ (ç¬¬ 1099-1110 è¡Œ)
    - ä½å±: 1-2 ä¸ª
    - ä¸­å±: 2-3 ä¸ª
    - é«˜å±: 2-4 ä¸ª
    - æå±: 3-5 ä¸ª

  - ä¼˜å…ˆä½¿ç”¨ AI ç”Ÿæˆ (ç¬¬ 1067-1070 è¡Œ)
  - AI å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°å¤‡ç”¨ç”Ÿæˆ (ç¬¬ 1071-1074 è¡Œ)
  - å°†ç‰©å“æ·»åŠ åˆ°èƒŒåŒ… (ç¬¬ 1085 è¡Œ)
  - æ›´æ–° POI çŠ¶æ€ä¸ºå·²æœåˆ® (ç¬¬ 1088-1092 è¡Œ)

### âœ… 6. UI æ˜¾ç¤º

**æ–‡ä»¶ï¼š** `Views/Exploration/ScavengeResultView.swift`

- **æ˜¾ç¤ºå±é™©ç­‰çº§** (ç¬¬ 57-66 è¡Œ)
  - POI åç§°ä¸‹æ–¹æ˜¾ç¤ºå±é™©ç­‰çº§æ ‡ç­¾
  - æ ¹æ®ç­‰çº§æ˜¾ç¤ºä¸åŒé¢œè‰²ï¼ˆç»¿/é»„/æ©™/çº¢ï¼‰

- **ç‰©å“æ•…äº‹å±•å¼€åŠŸèƒ½** (ç¬¬ 30-31, 126-164 è¡Œ)
  - ç‚¹å‡»ç‰©å“å¡ç‰‡å±•å¼€/æ”¶èµ·æ•…äº‹
  - ä¹¦æœ¬å›¾æ ‡æŒ‡ç¤ºæœ‰æ•…äº‹çš„ç‰©å“
  - å¹³æ»‘çš„å±•å¼€/æ”¶èµ·åŠ¨ç”»
  - æ•…äº‹æ–‡æœ¬è‡ªåŠ¨æ¢è¡Œ

### âœ… 7. å›½é™…åŒ–

**æ–‡ä»¶ï¼š** `Localizable.xcstrings`

å·²æ·»åŠ æ‰€æœ‰å¿…è¦ç¿»è¯‘ï¼š
- å±é™©ç­‰çº§ï¼šä½å±ã€ä¸­å±ã€é«˜å±ã€æå±
- ç¨€æœ‰åº¦ï¼šæ™®é€šã€ä¼˜ç§€ã€ç¨€æœ‰ã€å²è¯—ã€ä¼ å¥‡
- æ‰€æœ‰ UI æ–‡æœ¬

## å¾…æ‰‹åŠ¨å®Œæˆçš„æ­¥éª¤

### ğŸ”² 1. å®‰è£… Supabase CLI

```bash
# macOS
brew install supabase/tap/supabase

# æˆ–ä½¿ç”¨ npm
npm install -g supabase
```

### ğŸ”² 2. ç™»å½• Supabase

```bash
supabase login
```

### ğŸ”² 3. è·å–é˜¿é‡Œäº‘ç™¾ç‚¼ API Key

1. è®¿é—® [é˜¿é‡Œäº‘ç™¾ç‚¼æ§åˆ¶å°](https://bailian.console.aliyun.com/)
2. åˆ›å»ºåº”ç”¨
3. è·å– `DASHSCOPE_API_KEY`

### ğŸ”² 4. éƒ¨ç½² Edge Function

```bash
cd "/Users/xinqidian/Desktop/AIå­¦ä¹ /new earth lord1"
supabase functions deploy generate-ai-items --project-ref ipvkhcrgbbcccwiwlofd
```

### ğŸ”² 5. é…ç½®ç¯å¢ƒå˜é‡

**æ–¹æ³• 1ï¼šä½¿ç”¨ CLI**
```bash
supabase secrets set DASHSCOPE_API_KEY=your-api-key-here --project-ref ipvkhcrgbbcccwiwlofd
```

**æ–¹æ³• 2ï¼šä½¿ç”¨ Dashboard**
1. è®¿é—® [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©é¡¹ç›® `ipvkhcrgbbcccwiwlofd`
3. Settings â†’ Edge Functions â†’ Environment Variables
4. æ·»åŠ ï¼š`DASHSCOPE_API_KEY` = ä½ çš„ API Key

### ğŸ”² 6. é…ç½® AIItemGenerator

**æ–‡ä»¶ï¼š** `new earth lord1/new_earth_lord1App.swift`

ç¡®ä¿åœ¨ App å¯åŠ¨æ—¶é…ç½® AIItemGeneratorï¼š

```swift
// åœ¨ init() æˆ– onAppear ä¸­æ·»åŠ 
AIItemGenerator.shared.configure(supabase: supabase)
```

### ğŸ”² 7. æµ‹è¯•åŠŸèƒ½

#### æµ‹è¯• Edge Functionï¼š

```bash
curl -X POST \
  https://ipvkhcrgbbcccwiwlofd.supabase.co/functions/v1/generate-ai-items \
  -H "Authorization: Bearer YOUR_SUPABASE_ANON_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "poiType": "åºŸå¼ƒè¶…å¸‚",
    "poiName": "åºŸå¼ƒçš„åè”è¶…å¸‚",
    "dangerLevel": 3,
    "itemCount": 3
  }'
```

#### æµ‹è¯• App åŠŸèƒ½ï¼š

1. å¼€å§‹æ¢ç´¢
2. æ¥è¿‘ä¸€ä¸ª POIï¼ˆè·ç¦» < 50mï¼‰
3. ç‚¹å‡»æœåˆ®
4. æŸ¥çœ‹ç”Ÿæˆçš„ç‰©å“
5. ç‚¹å‡»ç‰©å“å±•å¼€èƒŒæ™¯æ•…äº‹
6. éªŒè¯ç‰©å“ç¨€æœ‰åº¦ç¬¦åˆå±é™©ç­‰çº§

## å·¥ä½œæµç¨‹

### æ­£å¸¸æµç¨‹ï¼ˆAI ç”ŸæˆæˆåŠŸï¼‰

```
ç©å®¶æœåˆ® POI
    â†“
ExplorationManager.scavengePOI()
    â†“
AIItemGenerator.generateItems()
    â†“
è°ƒç”¨ Edge Function
    â†“
é˜¿é‡Œäº‘ç™¾ç‚¼ç”Ÿæˆç‰©å“
    â†“
è¿”å›ç‰©å“ï¼ˆå¸¦æ•…äº‹ï¼‰
    â†“
æ·»åŠ åˆ°èƒŒåŒ…
    â†“
æ˜¾ç¤ºæœåˆ®ç»“æœï¼ˆå¯å±•å¼€æ•…äº‹ï¼‰
```

### å¤‡ç”¨æµç¨‹ï¼ˆAI ç”Ÿæˆå¤±è´¥ï¼‰

```
ç©å®¶æœåˆ® POI
    â†“
ExplorationManager.scavengePOI()
    â†“
AIItemGenerator.generateItems() â†’ å¤±è´¥
    â†“
AIItemGenerator.generateFallbackItems()
    â†“
è¿”å›å¤‡ç”¨ç‰©å“ï¼ˆå¸¦ç®€å•æ•…äº‹ï¼‰
    â†“
æ·»åŠ åˆ°èƒŒåŒ…
    â†“
æ˜¾ç¤ºæœåˆ®ç»“æœ
```

## ç‰©å“ç¤ºä¾‹

### AI ç”Ÿæˆç‰©å“ç¤ºä¾‹ï¼ˆä½å± POIï¼‰

```json
{
  "name": "è¿‡æœŸèƒ½é‡æ£’",
  "category": "food",
  "rarity": "uncommon",
  "story": "åŒ…è£…ä¸Šçš„æ—¥æœŸæ˜¾ç¤ºè¿™æ˜¯ä¸‰å¹´å‰çš„äº§å“ï¼Œä½†å¯†å°å®Œå¥½ã€‚æ’•å¼€åŒ…è£…ï¼Œä¾ç¨€èƒ½é—»åˆ°å·§å…‹åŠ›çš„é¦™æ°”ã€‚",
  "icon": "fork.knife",
  "quantity": 1
}
```

### å¤‡ç”¨ç‰©å“ç¤ºä¾‹ï¼ˆæå± POIï¼‰

```json
{
  "name": "å·¥ä¸šçº§ç”µæ± ç»„",
  "category": "material",
  "rarity": "legendary",
  "story": "åœ¨é‡å·¥æœºæ¢°å‚çš„åºŸå¢Ÿä¸­å‘ç°çš„ç‰©å“ã€‚",
  "icon": "bolt.fill",
  "quantity": 1
}
```

## ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹ Edge Function æ—¥å¿—

**æ–¹æ³• 1ï¼šDashboard**
1. Supabase Dashboard â†’ Edge Functions â†’ generate-ai-items â†’ Logs

**æ–¹æ³• 2ï¼šCLI**
```bash
supabase functions logs generate-ai-items --project-ref ipvkhcrgbbcccwiwlofd
```

### App æ—¥å¿—æ ‡ç­¾

æœç´¢ä»¥ä¸‹æ—¥å¿—æ ‡ç­¾æ¥è°ƒè¯•ï¼š
- `[AIç”Ÿæˆå™¨]` - AIItemGenerator æ—¥å¿—
- `[AIç”Ÿæˆ]` - Edge Function æ—¥å¿—
- `[POI]` - POI æœåˆ®ç›¸å…³æ—¥å¿—

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šAI ä¸€ç›´ä½¿ç”¨å¤‡ç”¨ç”Ÿæˆ

**å¯èƒ½åŸå› ï¼š**
- Edge Function æœªéƒ¨ç½²
- DASHSCOPE_API_KEY æœªé…ç½®
- API Key æ— æ•ˆæˆ–è¿‡æœŸ
- ç½‘ç»œé—®é¢˜

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ Edge Function æ˜¯å¦éƒ¨ç½²æˆåŠŸ
2. éªŒè¯ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®
3. æµ‹è¯• API Key æ˜¯å¦æœ‰æ•ˆ
4. æŸ¥çœ‹ Edge Function æ—¥å¿—

### é—®é¢˜ï¼šç‰©å“ç¨€æœ‰åº¦ä¸ç¬¦åˆé¢„æœŸ

**æ£€æŸ¥ï¼š**
1. POI çš„ `dangerLevel` æ˜¯å¦æ­£ç¡®
2. Edge Function ä¸­çš„ç¨€æœ‰åº¦æç¤ºè¯æ˜¯å¦æ­£ç¡®
3. AI è¿”å›çš„ç¨€æœ‰åº¦æ˜ å°„æ˜¯å¦æ­£ç¡®

### é—®é¢˜ï¼šç‰©å“æ•…äº‹ä¸æ˜¾ç¤º

**æ£€æŸ¥ï¼š**
1. RewardItem çš„ `story` å­—æ®µæ˜¯å¦æœ‰å€¼
2. ScavengeResultView ä¸­çš„å±•å¼€é€»è¾‘æ˜¯å¦æ­£å¸¸
3. ç‚¹å‡»ç‰©å“æ—¶æ˜¯å¦è§¦å‘äº† tap äº‹ä»¶

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜å¸¸è§ç‰©å“**ï¼šå¯¹äºå¸¸è§ç»„åˆå¯ä»¥ç¼“å­˜ AI ç”Ÿæˆç»“æœ
2. **æ‰¹é‡ç”Ÿæˆ**ï¼šä¸€æ¬¡ç”Ÿæˆå¤šä¸ª POI çš„ç‰©å“
3. **é¢„ç”Ÿæˆ**ï¼šåœ¨æ¢ç´¢å¼€å§‹æ—¶é¢„ç”Ÿæˆä¸€äº›ç‰©å“
4. **è¶…æ—¶å¤„ç†**ï¼šè®¾ç½®åˆç†çš„ AI è°ƒç”¨è¶…æ—¶æ—¶é—´ï¼ˆå»ºè®® 10 ç§’ï¼‰

## æˆæœ¬ä¼°ç®—

### é˜¿é‡Œäº‘ç™¾ç‚¼ qwen-turbo

- æ¯æ¬¡æœåˆ®ç”Ÿæˆ 1-5 ä¸ªç‰©å“
- æ¯æ¬¡è°ƒç”¨çº¦ 500-1000 tokens
- å‚è€ƒä»·æ ¼ï¼šÂ¥0.0008/1k tokensï¼ˆå…·ä½“ä»¥é˜¿é‡Œäº‘ä¸ºå‡†ï¼‰
- ä¼°ç®—ï¼šæ¯æ¬¡æœåˆ®æˆæœ¬ < Â¥0.001

### Supabase Edge Function

- å…è´¹é¢åº¦ï¼š500K æ¬¡è°ƒç”¨/æœˆ
- è¶…å‡ºåï¼š$2/ç™¾ä¸‡æ¬¡è°ƒç”¨
- ä¼°ç®—ï¼šå¯¹äºå¤§å¤šæ•°ç”¨æˆ·å®Œå…¨å…è´¹

## æ‰©å±•å»ºè®®

### æœªæ¥å¯ä»¥è€ƒè™‘çš„åŠŸèƒ½ï¼š

1. **ç‰©å“å“è´¨å˜åŒ–**ï¼šåŒä¸€ç‰©å“æ ¹æ® POI çŠ¶æ€æœ‰ä¸åŒå“è´¨
2. **ç‰¹æ®Šäº‹ä»¶ç‰©å“**ï¼šç‰¹å®šæ¡ä»¶ä¸‹ç”Ÿæˆç¨€æœ‰ç‰©å“
3. **ç‰©å“ç»„åˆ**ï¼šAI ç”Ÿæˆç›¸å…³è”çš„ç‰©å“ç»„åˆ
4. **ä¸ªæ€§åŒ–ç”Ÿæˆ**ï¼šæ ¹æ®ç©å®¶å†å²ç”Ÿæˆåå¥½ç‰©å“
5. **å¤šè¯­è¨€æ•…äº‹**ï¼šAI ç›´æ¥ç”Ÿæˆå¤šè¯­è¨€ç‰ˆæœ¬çš„æ•…äº‹

## æ–‡æ¡£ç´¢å¼•

- **éƒ¨ç½²æŒ‡å—**: `supabase/EDGE_FUNCTION_DEPLOYMENT.md`
- **å®ç°è®¡åˆ’**: `~/.claude/plans/resilient-prancing-sunrise.md`
- **æœ¬æ–‡æ¡£**: `AI_ITEM_GENERATION_SUMMARY.md`

## è”ç³»æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œå¯æŸ¥çœ‹ï¼š
1. Edge Function æ—¥å¿—
2. App æ§åˆ¶å°æ—¥å¿—
3. é˜¿é‡Œäº‘ç™¾ç‚¼ API æ–‡æ¡£
4. Supabase Edge Functions æ–‡æ¡£
